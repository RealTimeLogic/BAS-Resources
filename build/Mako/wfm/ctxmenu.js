function ctxmenu(e,t){function a(e){$(document).unbind("click",a),$("#ctxmenu").remove(),ctxmenuactive=!1,1!=e&&$(".softblue").removeClass("softblue")}function c(e){return unescape($("a:first",e).attr("href"))}hidectxmenu=a;var s,d,f={download:function(e,t){window.location=cleanHref(wl.href)+c(t.first())+"?download="},rm:function(e,i){var l,n,o=i.length,t="Do you want to delete "+(1<o?o+" files":c(i.first()))+"?";confirm(t)&&(showWait(e),l=0,n=cleanHref(wl.href),function t(){$.ajax({type:"POST",url:n,data:{cmd:"rmt",file:c(i[l])},error:showError,success:function(e){!ajaxRsp(e,++l<o)&&l<o&&t()}})}())}};function i(e,t){a(!0),t.stopPropagation(),t.preventDefault(),(t.shiftKey?(n=d.index(s),l=d.index(e),i=Math.min(l,n),l=Math.max(l,n),0<=i&&0<=l&&d.slice(i,l+1).addClass("softblue"),$(e)):(e=$(e),t.ctrlKey||d.removeClass("softblue"),t.ctrlKey&&e.hasClass("softblue")?e.removeClass("softblue"):e.addClass("softblue"))).css("background",""),s=e,$(document).bind("click",a);var i,l,n='<div id="ctxmenu"><ul>',o=$(".softblue"),r=!1;o.each(function(){if(0!=$('img[class|="dir"]',this).length)return!(r=!0)}),r||1==o.length&&(n+='<li id="download"><img src="/rtl/wfm/download.gif" /> Download</li><li id="clipboard" href="'+c(o.first())+'"><img src="/rtl/wfm/clipboard.png" /> Copy URL</li>'),n+='<li id="rm"><img src="/rtl/wfm/delete.gif" /> Delete</li></ul></div>',$(n).appendTo("body").css("left",t.pageX+10).css("top",t.pageY).show(),$("#ctxmenu li").click(function(){a(!0);var e=f[$(this).attr("id")];e&&e(t,o),d.removeClass("softblue")}),$(".rtlm").jqmAddTrigger("#clipboard"),ctxmenuactive=!0}(d=$(e).parent().children()).children("td").attr("unselectable","on"),(ctxmenu=i)(s=e,t)}