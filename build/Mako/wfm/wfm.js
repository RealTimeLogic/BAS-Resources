var ctxmenuactive,hasAlbum,wl=window.location;function hidectxmenu(){}function diaOnShow(i){scroll(0,0);var e=(e=i.url||{WebDAVB:"/davdia.txt",SearchB:"/searchdia.txt"}[$(i.t).attr("id")])||"/clipboarddia.txt";$.get("/rtl/wfm"+e,function(e){var t,n="SearchB"==$(i.t).attr("id")?800:600,o=$(document).width(),r=(o<n?(t=0,n="100%"):t=(o-n)/2,i.w.html(e).css("width",n).css("left",t).css("top",100),initDialog(i));i.w.fadeIn(),$("span",i.w).click(function(){r&&r(),i.w.jqmHide()})})}function getscript(e,t,n,o){$.ajax({url:n?e:"/rtl/wfm"+e+".js",dataType:"script",data:o,success:function(){try{t()}catch(e){alert("Error:\n"+e)}},error:function(e,t){t?alert("Error: "+e+" : "+t):alert("Err status: "+e)}})}function cleanHref(e){var t=/(.+)(\?|#).*/.exec(e);return t?t[1]:e}function reload(){setTimeout("window.location.reload();",10)}function showWait(e){$('<div id="waiticon"></div>').appendTo("body");function t(e){e&&e.pageX&&$("#waiticon").css("left",e.pageX+10).css("top",e.pageY-48).show()}(showWait=t)(e)}function hideWait(){$("#waiticon").hide()}function ctxmenu(e,t){window.enableCtxMenu&&getscript(cleanHref(wl.href),function(){ctxmenu(e,t)},!0,{cmd:"ctxmenu"})}function mkDir(){var e=prompt("Folder Name:","New Folder");e&&$.ajax({type:"POST",url:cleanHref(wl.href),data:{cmd:"mkdirt",dir:unescape(e)},error:showError,success:function(e){ajaxRsp(e)}})}function ajaxRsp(e,t){return e&&e.err?showError(e):t||reload(),e&&e.err}function showError(e){var t="error";hideWait();try{t=e.err?e.emsg||e.err:403==e.status?"Permission denied.":"Status: "+e.status+"\n"+e.responseText}catch(e){}alert(t),reload()}function newWindow(){var e=new Date;window.open(cleanHref(wl.href),e.getMilliseconds(),"scrollbars=1,toolbar=0,status=0,resizable=1,width=800,height=640")||alert("Your browser is blocking the pop-up window")}$(function(){function t(e,t){$(e).parent().parent().css("background",t)}var a,c,n;function u(e){var t=$("#qview");e?t.remove():t.hide()}function s(){var e;a&&(clearTimeout(a),a=null),c&&(e=c,c=null,o(e))}function o(t){function n(n){var o,e=$(n.target).hasClass("lock"),t=e?$(n.target).next():$(n.target),t=unescape(t.attr("href")),r=/\.(jpg|jpeg|mp3)/i.exec(t.toLowerCase());function i(e){var t=n.pageY-130;t<50?t=50:t+300>$(document).height()&&(t=$(document).height()-300),e.appendTo("body").css("left",n.pageX+50).css("top",t)}(r||e)&&(u(!0),a?(c=n,clearTimeout(a),a=setTimeout(s,500)):(a=setTimeout(s,500),o='<div style="position:absolute;z-index:100" id="qview">',e?$.getJSON(cleanHref(wl.href),{cmd:"getlock",name:t},function(e){var t;c?s():(clearTimeout(a),a=null,e.owner?(t=new Date(1e3*e.time).toString("yyyy MMMM dd, dddd,  h:mm:ss tt"),i($(o+"<p>Locked by "+e.owner+". Expires "+t+"</p></div>"))):reload())}):"mp3"==r[1]?$.getJSON(cleanHref(wl.href),{cmd:"id3tag",name:t},function(t){function e(e){t[e]&&(n+="<tr><td>"+(e.charAt(0).toUpperCase()+e.slice(1))+": </td><td>"+t[e]+"</td></tr>")}var n;c?s():(clearTimeout(a),a=null,n="<table>",e("title"),e("artist"),e("album"),e("year"),e("comment"),n+="</table>",i(o=$(o+n+"</div>")))}):(i(o=$(o+'<img src="'+cleanHref(wl.href)+"?cmd=qview&name="+t+'"/></div>')),$("#qview img").load(function(){1==$(this).width()?u(!0):c?s():(clearTimeout(a),a=null)}))))}window.enableCtxMenu&&$.ajax({type:"POST",url:cleanHref(wl.href),data:{cmd:"qview"},error:function(){o=function(){}},success:function(e){(o=n)(t)}})}$.cookie("tzone")||$.cookie("tzone","-"+(new Date).getTimezoneOffset(),{expires:180}),$("#NewFolderB").click(function(e){mkDir(),e.preventDefault()}),$("#UploadB").click(function(e){upload(),e.preventDefault()}),$("#NewWindowB").click(function(e){newWindow(),e.preventDefault()}),$('<div class="rtlm"></div>').appendTo("body").jqm({trigger:"#WebDAVB,#SearchB",modal:!0,onShow:diaOnShow,overlay:80,onHide:function(e){e.w.fadeOut(function(){e.o&&e.o.remove()})}}),$("#fstab tbody tr").click(function(e){ctxmenu(this,e)}).bind("contextmenu",function(e){e.preventDefault(),ctxmenu(this,e)}),$("#fstab tr a").click(function(e){e.stopImmediatePropagation()}).mouseover(function(e){e.stopImmediatePropagation(),hidectxmenu(),o(e),t(this,"#B6D7EB")}).mouseout(function(e){u(),e.stopImmediatePropagation(),t(this,"")}),$("#fstab").mouseout(u),$("#fstab tr").mouseover(function(e){ctxmenuactive||$(this).css("background","#FFFF66")}).mouseout(function(){ctxmenuactive||$(this).css("background","")}),$("#fstab .lock").mouseover(function(e){hidectxmenu(),o(e)}).mouseout(function(e){u()});var r=!1;$("body").bind("dragover",function(e){n||(n=[],$("<div></div>").appendTo("body").load("/rtl/wfm/dragdrop.txt",function(){startDragDrop(n)})),e.preventDefault()}).bind("drop",function(e){if(r)return!0;r=!0;var t=e.originalEvent.dataTransfer.files;for(k in t)n.push(t[k]);e.preventDefault()});try{var e=0<window.navigator.userAgent.search(/windows/i)?"Map windows drive letter to current directory using a session URL":"Mount current directory using a WebDAV session URL";$("#WebDAVB").attr("title",e)}catch(e){}try{$("table").tablesorter({sortList:window.sortList||[[0,0]],widgets:["zebra"],textExtraction:function(e){var t=e.childNodes[0],t=t&&t.hasChildNodes()?t.innerHTML:t&&"IMG"==t.nodeName?"-1":e.innerHTML;return t}}).addClass("ctxmcur");function i(){hasAlbum||$.ajax({url:"/rtl/wfm-album/loading.gif",type:"HEAD",success:function(){$("<a id='AlbumB' href='#' target='album' title='Photo Album'></a>").appendTo("#menulinks"),$("#AlbumB").click(function(e){window.open("/rtl/wfm-album/?href="+cleanHref(wl.href),"album"),$(this).blur(),e.preventDefault()})}}),hasAlbum=!0}var l,d={jpg:i,jpeg:i,gif:i,png:i,mp3:function(e){l?l[l.length]=e:(l=[e],getscript("-mp3/insertplayer",function(){insertPlayer(l),l=null}))}};$("tbody a").each(function(){var e=$(this).attr("href"),e=/\.(jpg|jpeg|gif|png|mp3)/i.exec(e);e&&d[e[1].toLowerCase()](this)})}catch(e){}});var uploadF=!1;function upload(){var e="File: <input class='uploadfn' type='file' size='40' name='file' multiple='true'/>";if(uploadF){var t="<br/>"+e;$(t).insertBefore("#SubmUpload")}else{var n="";try{(new XMLHttpRequest).upload.addEventListener("progress",function(){},!1),n="<span style='color:yellow'><b>Note:</b> Drag and drop upload is supported by this browser! Drop your file(s) into the box.</span>",$('<img id="dropbox" src="/rtl/wfm/dropbox.png"/>').appendTo("body"),$("#dropbox").show(),$("#resources").fadeTo(400,.1)}catch(e){}t="<div><form method='post' enctype='multipart/form-data'>"+e+"<input id = 'SubmUpload' type='Submit' value='Upload file'/></form>"+n+"</div>";$(t).insertAfter("#curdir"),$("#SubmUpload").click(function(){var t=!0;return $(".uploadfn").each(function(e){if(!$(this).val())return reload(),t=!1}),t}),uploadF=!0}}