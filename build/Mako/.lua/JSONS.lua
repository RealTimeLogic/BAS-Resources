local a=table.remove;local b=table.insert;local c=ba.json.encode;local d={}d.__index=d;function d:get(e)if#self._data>0 then return a(self._data,1)end;while true do local f;local g,h=self._sock:read(e)if not g then return nil,h end;self._size=self._size+#g;g,f=self._parser:parse(g,true)if not g then return nil,f end;if f then self._data=f;self._size=0;return a(self._data,1)end;if self._mxs and self._size>=self._mxs then return nil,"maxsize"end end end;function d:put(f)return self._sock:write(c(f))end;function d:close()return self._sock:close()end;return{create=function(i,j,k)setmetatable(i,d)i._parser=ba.json.parser()i._sock=j;i._mxs=k;i._size=0;i._data={}return i end}